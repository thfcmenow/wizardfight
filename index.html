<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizards Fight Intro</title>
    <!-- Importing a fantasy-style font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000; /* Deep black background */
            font-family: 'Cinzel', serif;
        }
        canvas {
            display: block;
        }
        #fullscreen-banner {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.85);
            border-bottom: 1px solid #b08aff;
            color: #fff;
            font-family: 'Cinzel', serif;
            font-size: 15px;
            text-align: center;
            padding: 14px 20px;
            cursor: pointer;
            letter-spacing: 0.05em;
        }
        #fullscreen-banner span {
            color: #b08aff;
        }
    </style>
</head>
<body>

<div id="fullscreen-banner"></div>
<canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // State management
    let width, height;
    let frame = 0;
    let gameState = 'waiting_for_storm'; // waiting_for_storm, striking, title_screen, teleporting
    let lightningOpacity = 0;
    let flashOpacity = 0;
    let titleVisible = false;
    let titleAlpha = 0;
    
    // Lightning Bolt Data
    let boltPath = [];
    
    // Setup Canvas
    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // Helper: Random number generator
    function random(min, max) {
        return Math.random() * (max - min) + min;
    }

    // Generate a jagged lightning path
    function generateBolt(startX, startY, endX, endY) {
        const segments = [];
        let currX = startX;
        let currY = startY;
        const steps = 20;
        const yStep = (endY - startY) / steps;
        
        segments.push({x: currX, y: currY});

        for (let i = 0; i < steps; i++) {
            currY += yStep;
            // Jitter x position to create jagged line, keep it somewhat centered
            currX += random(-30, 30); 
            
            // Pull back towards center if it strays too far
            if(currX < width/2 - 100) currX += 20;
            if(currX > width/2 + 100) currX -= 20;

            segments.push({x: currX, y: currY});
        }
        return segments;
    }

    // Input Handling
    function startGame() {
        if (gameState === 'title_screen') {
            gameState = 'teleporting';
        }
    }

    window.addEventListener('keydown', (e) => {
        if (e.code === 'Space') startGame();
    });

    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        startGame();
    }, { passive: false });

    // Animation Loop
    function animate() {
        // Clear screen (partial fade for trail effect if needed, but solid black is cleaner here)
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, width, height);

        frame++;

        // --- PHASE 1: Build up tension (random flickers) ---
        if (gameState === 'waiting_for_storm') {
            // Occasional faint background flashes
            if (random(0, 100) > 95) {
                ctx.fillStyle = `rgba(20, 20, 40, ${random(0.05, 0.15)})`;
                ctx.fillRect(0, 0, width, height);
            }

            // Trigger the big strike around frame 100
            if (frame > 100) {
                gameState = 'striking';
                boltPath = generateBolt(width / 2, 0, width / 2, height * 0.6);
                flashOpacity = 1.0; // Full screen white flash
                lightningOpacity = 1.0;
                titleVisible = true;
            }
        }

        // --- PHASE 2: The Strike ---
        if (gameState === 'striking') {
            // Draw White Screen Flash
            if (flashOpacity > 0) {
                ctx.fillStyle = `rgba(255, 255, 255, ${flashOpacity})`;
                ctx.fillRect(0, 0, width, height);
                flashOpacity -= 0.05; // Fade out flash quickly
            }

            // Draw Lightning Bolt
            if (lightningOpacity > 0) {
                ctx.beginPath();
                ctx.moveTo(boltPath[0].x, boltPath[0].y);
                for (let i = 1; i < boltPath.length; i++) {
                    ctx.lineTo(boltPath[i].x, boltPath[i].y);
                }
                
                ctx.strokeStyle = `rgba(200, 220, 255, ${lightningOpacity})`;
                ctx.lineWidth = 4;
                ctx.shadowBlur = 20;
                ctx.shadowColor = "cyan";
                ctx.stroke();
                ctx.shadowBlur = 0; // Reset

                lightningOpacity -= 0.02; // Fade out bolt
            } else {
                gameState = 'title_screen';
            }
        }

        // --- PHASE 3: Title Screen ---
        if (titleVisible || gameState === 'title_screen' || gameState === 'teleporting') {
            
            // Fade title in immediately after strike
            if (titleAlpha < 1) titleAlpha += 0.05;

            // 1. Draw "WIZARDS FIGHT"
            ctx.save();
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Pulse logic
            const time = Date.now() / 1000;
            const pulse = (Math.sin(time * 2) + 1) / 2; // 0 to 1
            const glowSize = 20 + (pulse * 20); // 20 to 40
            
            ctx.font = '900 80px "Cinzel"';
            ctx.shadowColor = '#b08aff'; // Magical Purple/Blue glow
            ctx.shadowBlur = glowSize;
            ctx.fillStyle = `rgba(255, 255, 255, ${titleAlpha})`;
            
            // Apply scale jitter for "electric" feel
            const jitterX = gameState === 'teleporting' ? random(-5,5) : 0;
            const jitterY = gameState === 'teleporting' ? random(-5,5) : 0;
            
            ctx.fillText("WIZARDS FIGHT", (width / 2) + jitterX, (height / 2) + jitterY);
            ctx.restore();

            // 2. Draw "PRESS SPACE BAR TO PLAY"
            if (gameState === 'title_screen') {
                ctx.save();
                ctx.textAlign = 'center';
                ctx.font = '400 24px "Cinzel"';
                
                // Faster blink
                const blink = (Math.sin(time * 5) + 1) / 2; 
                ctx.fillStyle = `rgba(200, 200, 200, ${blink * titleAlpha})`;
                
                ctx.fillText("TAP SCREEN  OR  PRESS SPACE TO PLAY", width / 2, height / 2 + 80);
                ctx.restore();
            }

            // 3. Feedback for pressing space
            if (gameState === 'teleporting') {
                ctx.save();
                ctx.textAlign = 'center';
                ctx.font = '400 24px "Cinzel"';
                ctx.fillStyle = '#0ff';
                ctx.fillText("SUMMONING PORTAL...", width / 2, height / 2 + 80);
                
                // Fade to white for transition
                flashOpacity += 0.02;
                if(flashOpacity > 0) {
                     ctx.fillStyle = `rgba(255, 255, 255, ${flashOpacity})`;
                     ctx.fillRect(0,0,width,height);
                }
                ctx.restore();
                setTimeout(() => {
                    window.location.href = 'game';
                }, 20);
            }
        }

        requestAnimationFrame(animate);
    }

    // Start
    animate();

    // --- Fullscreen Prompt (mobile only) ---
    (function () {
        const isMobile = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const banner = document.getElementById('fullscreen-banner');

        if (!isMobile) return;

        if (isIOS) {
            // iOS Safari doesn't support requestFullscreen for web pages
            banner.innerHTML = 'For the best experience: tap <span>Share â¬†</span> then <span>"Add to Home Screen"</span>';
            banner.style.display = 'block';
            // Dismiss on tap
            banner.addEventListener('touchstart', () => {
                banner.style.display = 'none';
            }, { passive: true });
        } else {
            // Android / other mobile - Fullscreen API supported
            const canFullscreen = document.documentElement.requestFullscreen
                || document.documentElement.webkitRequestFullscreen;

            if (!canFullscreen) return;

            banner.innerHTML = '&#x26A1; Tap here to enable <span>Full Screen</span> &#x26A1;';
            banner.style.display = 'block';

            banner.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const el = document.documentElement;
                if (el.requestFullscreen) el.requestFullscreen();
                else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
            }, { passive: false });

            document.addEventListener('fullscreenchange', () => {
                if (document.fullscreenElement) {
                    banner.style.display = 'none';
                }
            });
        }
    })();

</script>
</body>
</html>